#!/usr/bin/env bash
set -euo pipefail

if [ "$#" -lt 1 ]; then
  echo "Usage: dynare-octave-docker <mod-file> [ignored extra args]" >&2
  exit 2
fi

if [ "$1" = "--version" ]; then
  echo "dynare-octave-docker (wmutschl/dynare-octave:5.4)"
  exit 0
fi

mod_file="$1"

docker run --rm \
  --platform linux/amd64 \
  -v "$PWD":/work \
  -w /work \
  wmutschl/dynare-octave:5.4 \
  /bin/bash -lc "octave --no-gui --quiet --eval \"addpath('/workspace/dynare/matlab'); dynare('$mod_file','nolog','noclearall');\""
